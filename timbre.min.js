/**
 * timbre 0.0.0 / JavaScript Library for Objective Sound Programming
 */var timbre=function(a,b){"use strict";var b=function(){return b.fn.init.apply(b,arguments)};b.VERSION="0.0.0",b.BUILD="Thu May 24 2012 07:33:32 GMT+0900 (JST)",b.env="",b.platform="",b.workerpath="",b.samplerate=44100,b.channels=2,b.cellsize=128,b.streamsize=1024,b.amp=.8,b.verbose=!0,b.dacs=[],b.timers=[],b._ev={},b._sys=null,b._global={};var c=function(){var a=function(){d.apply(this,arguments)},c=a.prototype,d=function(a,c){a=a||b.streamsize,c=c||b.channels,c=c===1?1:2,this.streamsize=a,this.channels=c,this.L=new Float32Array(a),this.R=new Float32Array(a),this._impl=null,this._ison=!1,this._cell=new Float32Array(b.cellsize),this._cellsize=b.cellsize,this._seq_id=0};c.bind=function(a){this._impl=new a(this)},c.on=function(){this._impl&&(this._ison=!0,this._impl.on())},c.off=function(){this._impl&&(this._impl.off(),this._ison=!1)},c.process=function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;a=this._cell,c=this.L,d=this.R,t=b.amp,e=this._seq_id,k=c.length,n=this._cellsize,p=this.streamsize/n,q=0;for(j=k;j--;)c[j]=d[j]=0;for(o=p;o--;){++e,h=b.timers.slice(0);for(l=h.length;l--;)(i=h[l])!==undefined&&i.seq(e);f=b.dacs.slice(0);for(l=f.length;l--;)if((g=f[l])!==undefined){g.seq(e),r=g._L,s=g._R;for(m=0,j=q;m<n;++m,++j)c[j]+=r[m],d[j]+=s[m]}q=j}for(j=k=c.length;j--;)u=c[j]*t,u<-1?u=-1:1<u&&(u=1),c[j]=u,u=d[j]*t,u<-1?u=-1:1<u&&(u=1),d[j]=u;for(m=n;m--;)a[m]=c[m]+d[m],u=a[m]*t*.5,u<-1?u=-1:1<u&&(u=1),a[m]=u;this._seq_id=e};return a}();b._sys=new c,Object.defineProperty(b,"isOn",{get:function(){return b._sys._ison}}),Object.defineProperty(b,"isOff",{get:function(){return!b._sys._ison}}),b.on=function(){b._sys._ison||(b._sys.on(),b.fn.do_event(this,"on"));return b},b.off=function(){b._sys._ison&&(b._sys.off(),b.fn.do_event(this,"off"));return b},b.addEventListener=function(a,b){var c,d,e;typeof b=="function"&&(a[0]==="~"&&(a=a.substr(1),b.rm=!0),c=this._ev[a],c===undefined&&(this._ev[a]=c=[]),(e=c.indexOf(b))===-1&&c.push(b));return this},b.removeEventListener=function(a,b){var c,d;typeof a=="string"&&a!==""&&(c=this._ev[a],c!==undefined&&(d=c.indexOf(b))!==-1&&c.splice(d,1));return this},b.removeAllEventListeners=function(a){typeof a=="string"&&a!==""&&(delete this._ev[a],delete this["on"+a]);return this},b.fn=function(a){var b={},c={};c.find=function(a){if(typeof c[a]=="function")return c[a]};var i={optional:{},properties:{}};i.optional.ar=function(){this._ar=!0;return this},i.optional.kr=function(){this._ar=!1;return this},i.optional.fixArKr=function(){return this},b.init=function(){var b,j,k,l;b=Array.prototype.slice.call(arguments),j=b[0];switch(typeof j){case"string":k=c.find(j),k&&(l=new k(b.slice(1)));break;case"number":l=new d([j]);break;case"boolean":l=new e([j]);break;case"function":l=new f(b);break;case"object":j&&typeof j.clone=="function"&&(l=j.clone())}l===undefined&&(j===null?l=new h:l=new g),l._seq_id=-1,l._cell||(l._cell=new Float32Array(a.cellsize)),l.args||(l.args=[]),a.fn.init_set.call(l.args,l._raw_args),l._ev||(l._ev={}),typeof l._ar!="boolean"&&(l._ar=!1),l._seq=l.seq,typeof l._ar=="boolean"?(typeof l.ar!="function"&&(l.ar=i.optional.ar),typeof l.kr!="function"&&(l.kr=i.optional.kr)):l.ar=l.kr=i.optional.fixArKr,l._ar=!!l._ar,l._post_init&&l._post_init();return l};var j=function(){var b=new Float32Array(a.cellsize);return function(){return b}}();i.play=function(){this.dac.isOff&&(this.dac.on(),a.fn.do_event(this,"play"));return this},i.pause=function(){this.dac.isOn&&(this.dac.off(),a.fn.do_event(this,"pause"));return this},i.bang=function(){a.fn.do_event(this,"bang");return this},i.seq=function(){return this._cell},i.on=function(){this.seq=this._seq,a.fn.do_event(this,"on");return this},i.off=function(){this.seq=j,a.fn.do_event(this,"off");return this},i.clone=function(){return new this._klass(this.args)},i.append=function(){this.args.append.apply(this.args,arguments);return this},i.remove=function(){this.args.remove.apply(this.args,arguments);return this},i.set=function(a,b){var c;c=this;while(c!==null){if(Object.getOwnPropertyDescriptor(c,a)){this[a]=b;break}c=Object.getPrototypeOf(c)}return this},i.get=function(a){var b,c;b=this;while(b!==null){if(Object.getOwnPropertyDescriptor(b,a)){c=this[a];break}b=Object.getPrototypeOf(b)}return c},i.addEventListener=a.addEventListener,i.removeEventListener=a.removeEventListener,i.removeAllEventListeners=a.removeAllEventListeners,i.properties.isAr={get:function(){return!!this._ar}},i.properties.isKr={get:function(){return!this._ar}},i.properties.dac={set:function(a){this._dac&&this._dac.remove(this),this._dac=a.append(this)},get:function(){this._dac||(this._dac=a("dac",this));return this._dac}},i.properties.mul={set:function(a){typeof a=="number"&&(this._mul=a)},get:function(){return this._mul}},i.properties.add={set:function(a){typeof a=="number"&&(this._add=a)},get:function(){return this._add}},b.register=function(a,b,d){var e,f;if(typeof b=="function"){f=b.prototype;for(e in i)typeof i[e]=="function"&&(f[e]||(f[e]=i[e]));for(e in i.properties)Object.getOwnPropertyDescriptor(f,e)||Object.defineProperty(f,e,i.properties[e]);f._mul=1,f._add=0,f._ar===!0&&(f.ar=f.kr=i.optional.fixArKr),typeof a=="string"&&(d?c[a]=d:(f._klass=b,f._name=a,c[a]=b))}},b.valist=function(b){var c,d,e;c=[];for(d=0,e=b.length;d<e;++d)switch(typeof b[d]){case"number":case"boolean":case"function":case"undefined":c.push(a(b[d]));break;case"object":b[d]===null?c.push(a(null)):c.push(b[d]);break;default:c.push(a(undefined))}return c},b.init_set=function(){var a=function(){var a,c;a=b.valist(arguments);for(c=a.length;c--;)this.indexOf(a[c])===-1&&this.push(a[c]);return this},c=function(){var a,b;a=arguments;for(b=a.length;b--;)this.indexOf(a[b])===-1&&this.push(a[b]);return this},d=function(){var a,b;for(a=arguments.length;a--;)(b=this.indexOf(arguments[a]))!==-1&&this.splice(b,1);return this},e=function(){this.append.apply(this,list);return this};return function(b){this.append=b?c:a,this.remove=d,this.update=e;return this}}(),b.do_event=function(a,b,c){var d,e,f;d=a["on"+b],typeof d=="function"&&d.apply(a,c),e=a._ev[b];if(e!==undefined)for(f=e.length;f--;)d=e[f],d.apply(a,c),d.rm&&a.removeEventListener(b,d)};return b}(b),b.fn.init_set.call(b.dacs),b.fn.init_set.call(b.timers);var d=function(){var a=function(){c.apply(this,arguments)},b=a.prototype;Object.defineProperty(b,"value",{set:function(a){var b,c;if(typeof a=="number"){this._value=a,b=this._cell;for(c=b.length;c--;)b[c]=a}},get:function(){return this._value}});var c=function(a){typeof a[0]=="number"?this._value=a[0]:this._value=0};b._post_init=function(){this.value=this._value},b.clone=function(){return new a([this.value])};return a}();b.fn.register("number",d);var e=function(){var a=function(){c.apply(this,arguments)},b=a.prototype;Object.defineProperty(b,"value",{set:function(a){var b,c,d;this._value=!!a,b=this._cell,d=this._value?1:0;for(c=b.length;c--;)b[c]=d},get:function(){return this._value}});var c=function(a){typeof a[0]=="boolean"?this._value=a[0]:this._value=!1};b._post_init=function(){this.value=this._value},b.clone=function(){return new a([this.value])};return a}();b.fn.register("boolean",e);var f=function(){var a=function(){e.apply(this,arguments)},c=a.prototype,d=function(a){return a};Object.defineProperty(c,"func",{set:function(a){typeof a=="function"&&(this._func=a)},get:function(){return this._func}}),Object.defineProperty(c,"freq",{set:function(a){typeof a=="object"?this._freq=a:this._freq=b(a)},get:function(){return this._freq}}),Object.defineProperty(c,"phase",{set:function(a){if(typeof a=="number"){while(a>=1)a-=1;while(a<0)a+=1;this._x=this._phase=a}},get:function(){return this._phase}});var e=function(a){var c,e;c=0,typeof a[c]=="function"?this.func=a[c++]:this.func=d,this.freq=a[c++],typeof a[c]=="number"?this.phase=a[c++]:this.phase=0,typeof a[c]=="number"&&(this.mul=a[c++]),typeof a[c]=="number"&&(this.add=a[c++]),this._x=this._phase,this._coeff=1/b.samplerate};c.clone=function(){return new a([this.func,this.freq,this.phase,this.mul,this.add])},c.bang=function(){this._x=this._phase,b.fn.do_event(this,"bang");return this},c.seq=function(a){var b,c,d,e,f;b=this._cell;if(a!==this._seq_id){c=this._x,d=this._func(c)*this._mul+this._add;for(e=b.length;e--;)b[e]=d;c+=this._freq.seq(a)[0]*this._coeff;while(c>=1)c-=1;this._x=c,this._seq_id=a}return b};return a}();b.fn.register("function",f);var g=function(){};b.fn.register("undefined",g);var h=function(){};b.fn.register("null",h);var j=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"dac",{get:function(){return this}}),Object.defineProperty(c,"pan",{set:function(a){typeof a!="object"?this._pan=b(a):this._pan=a},get:function(){return this._pan}}),Object.defineProperty(c,"amp",{set:function(a){typeof a=="number"&&(this._mul=a)},get:function(){return this._mul}}),Object.defineProperty(c,"isOn",{get:function(){return this._ison}}),Object.defineProperty(c,"isOff",{get:function(){return!this._ison}});var d=function(a){this.args=b.fn.valist.call(this,a),this.pan=.5,this._L=new Float32Array(b.cellsize),this._R=new Float32Array(b.cellsize),this._prev_pan=undefined,this._mul=1,this._ison=!1};c._ar=!0,c._post_init=function(){var a,b;b=this.args;for(a=b.length;a--;)b[a].dac=this},c.on=c.play=function(){this._ison=!0,b.dacs.append(this),b.fn.do_event(this,"play"),b.fn.do_event(this,"on");return this},c.off=c.pause=function(){this._ison=!1,b.dacs.remove(this),b.fn.do_event(this,"off"),b.fn.do_event(this,"pause");return this},c.seq=function(a){var c,d,e,f,g,h,i,j,k,l,m,n;d=this._cell;if(a!==this._seq_id){c=this.args,e=this._L,f=this._R,h=this._pan.seq(a)[0],h!==this._prev_pan&&(this._panL=Math.cos(.5*Math.PI*h),this._panR=Math.sin(.5*Math.PI*h),this._prev_pan=h),g=this._mul,i=this._panL*g,j=this._panR*g,n=b.cellsize;for(m=n;m--;)d[m]=e[m]=f[m]=0;for(l=c.length;l--;)if((k=c[l])!==undefined){k=k.seq(a);for(m=n;m--;)d[m]+=k[m]*g,e[m]+=k[m]*i,f[m]+=k[m]*j}this._seq_id=a}return d};return a}();b.fn.register("dac",j),b.fn.register("pandac",j,function(a){var b=new j(a.slice(1));b.pan=a[0];return b});var k=function(){var a=function(){d.apply(this,arguments)},c=a.prototype,d=function(a){this.args=b.fn.valist.call(this,a),c._ar=!0};c.seq=function(a){var c,d,e,f,g,h;d=this._cell;if(a!==this._seq_id){c=this.args,h=b.cellsize;for(g=h;g--;)d[g]=0;for(f=c.length;f--;){e=c[f].seq(a);for(g=h;g--;)d[g]+=e[g]}this._seq_id=a}return d};return a}();b.fn.register("+",k);var l=function(){var a=function(){d.apply(this,arguments)},c=a.prototype,d=function(a){this.args=b.fn.valist.call(this,a),this._ar=!0};c.seq=function(a){var c,d,e,f,g,h;d=this._cell;if(a!==this._seq_id){c=this.args,h=b.cellsize;for(g=h;g--;)d[g]=1;for(f=c.length;f--;){e=c[f].seq(a);for(g=h;g--;)d[g]*=e[g]}this._seq_id=a}return d};return a}();b.fn.register("*",l);var m=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"wavelet",{set:function(b){var c,d,e,f,g,h;c=this._wavelet;if(typeof b=="function")for(d=0;d<1024;d++)c[d]=b(d/1024);else if(typeof b=="object"&&b instanceof Float32Array)if(b.length===1024)c.set(b,0,1024);else{h=b.length/1024;for(d=0;d<1024;d++)c[d]=b[d*h|0]||0}else if(typeof b=="string"&&(h=a.wavelets[b])!==undefined)for(d=0;d<1024;d++)c[d]=h[d]},get:function(){return this._wavelet}}),Object.defineProperty(c,"freq",{set:function(a){typeof a=="object"?this._freq=a:this._freq=b(a)},get:function(){return this._freq}}),Object.defineProperty(c,"phase",{set:function(a){if(typeof a=="number"){while(a>=1)a-=1;while(a<0)a+=1;this._phase=a,this._x=1024*this._phase}},get:function(){return this._phase}});var d=function(a){var c;c=0,this._wavelet=new Float32Array(1024),typeof a[c]=="function"?this.wavelet=a[c++]:typeof a[c]=="object"&&a[c]instanceof Float32Array?this.wavelet=a[c++]:typeof a[c]=="string"&&(this.wavelet=a[c++]),this.freq=a[c++],typeof a[c]=="number"?this.phase=a[c++]:this.phase=0,typeof a[c]=="number"&&(this.mul=a[c++]),typeof a[c]=="number"&&(this.add=a[c++]),this._x=1024*this._phase,this._coeff=1024/b.samplerate,this._ar=!0};c.clone=function(){return new a([this.wavelet,this.freq,this.phase,this.mul,this.add])},c.bang=function(){this._x=1024*this._phase,b.fn.do_event(this,"bang");return this},c.seq=function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;c=this._cell;if(a!==this._seq_id){d=this._freq.seq(a),e=this._mul,f=this._add,g=this._wavelet,h=this._x,j=this._coeff;if(this._ar)if(this._freq._ar)for(p=0,q=b.cellsize;p<q;++p)k=h|0,l=h-k,m=g[k&1023],n=g[k+1&1023],o=(1-l)*m+l*n,c[p]=o*e+f,h+=d[p]*j;else{i=d[0]*j;for(p=0,q=b.cellsize;p<q;++p)k=h|0,l=h-k,m=g[k&1023],n=g[k+1&1023],o=(1-l)*m+l*n,c[p]=o*e+f,h+=i}else{k=h|0,l=h-k,m=g[k&1023],n=g[k+1&1023],o=(1-l)*m+l*n,o=o*e+f;for(p=0,q=b.cellsize;p<q;++p)c[p]=o;h+=d[0]*j*q}this._x=h,this._seq_id=a}return c};return a}();b.fn.register("osc",m),m.wavelets={},m.wavelets.sin=function(){var a,b;a=new Float32Array(1024);for(b=0;b<1024;++b)a[b]=Math.sin(2*Math.PI*(b/1024));return a}(),m.wavelets.cos=function(){var a,b;a=new Float32Array(1024);for(b=0;b<1024;++b)a[b]=Math.cos(2*Math.PI*(b/1024));return a}(),m.wavelets.pulse=function(){var a,b;a=new Float32Array(1024);for(b=0;b<1024;++b)a[b]=b<512?-1:1;return a}(),m.wavelets.tri=function(){var a,b,c;a=new Float32Array(1024);for(c=0;c<1024;++c)b=c/1024-.25,a[c]=1-4*Math.abs(Math.round(b)-b);return a}(),m.wavelets.sawup=function(){var a,b,c;a=new Float32Array(1024);for(c=0;c<1024;++c)b=c/1024,a[c]=2*(b-Math.round(b));return a}(),m.wavelets.saw=m.wavelets.sawup,m.wavelets.sawdown=function(){var a,b,c;a=new Float32Array(1024);for(c=0;c<1024;++c)b=c/1024,a[c]=-2*(b-Math.round(b));return a}(),m.wavelets.fami=function(){var a,b,c,d,e;b=[0,.125,.25,.375,.5,.625,.75,.875,.875,.75,.625,.5,.375,.25,.125,0,-0.125,-0.25,-0.375,-0.5,-0.625,-0.75,-0.875,-1,-1,-0.875,-0.75,-0.625,-0.5,-0.375,-0.25,-0.125],a=new Float32Array(1024);for(d=0;d<1024;++d)a[d]=b[d/1024*b.length|0];return a}(),m.wavelets.konami=function(){var a,b,c,d,e;b=[-0.625,-0.875,-0.125,.75,.5,.125,.5,.75,.25,-0.125,.5,.875,.625,0,.25,.375,-0.125,-0.75,0,.625,.125,-0.5,-0.375,-0.125,-0.75,-1,-0.625,0,-0.375,-0.875,-0.625,-0.25],a=new Float32Array(1024);for(d=0;d<1024;++d)a[d]=b[d/1024*b.length|0];return a}(),b.fn.register("sin",function(a){return new m(["sin"].concat(a))}),b.fn.register("cos",function(a){return new m(["cos"].concat(a))}),b.fn.register("pulse",function(a){return new m(["pulse"].concat(a))}),b.fn.register("tri",function(a){return new m(["tri"].concat(a))}),b.fn.register("saw",function(a){return new m(["saw"].concat(a))}),b.fn.register("sawup",function(a){return new m(["sawup"].concat(a))}),b.fn.register("sawdown",function(a){return new m(["sawdown"].concat(a))}),b.fn.register("fami",function(a){return new m(["fami"].concat(a))}),b.fn.register("konami",function(a){return new m(["konami"].concat(a))});var n=function(){var a=function(){c.apply(this,arguments)},b=a.prototype,c=function(a){var b;b=0,typeof a[b]=="number"&&(this.mul=a[b++]),typeof a[b]=="number"&&(this.add=a[b++]),this._ar=!0};b.ar=function(){this._ar=!0;return this},b.kr=function(){this._ar=!1;return this},b.seq=function(a){var b,c,d,e,f;b=this._cell;if(a!==this._seq_id){c=this._mul,d=this._add;if(this._ar)for(f=b.length;f--;)b[f]=(Math.random()*2-1)*c+d;else{e=(Math.random()*2-1)*c+d;for(f=b.length;f--;)b[f]=e}this._seq_id=a}return b};return a}();b.fn.register("noise",n);var o=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"a",{set:function(a){typeof a=="number"&&(this._a=a)},get:function(){return this._a}}),Object.defineProperty(c,"d",{set:function(a){typeof a=="number"&&(this._d=a)},get:function(){return this._d}}),Object.defineProperty(c,"s",{set:function(a){typeof a=="number"&&(this._s=a)},get:function(){return this._s}}),Object.defineProperty(c,"r",{set:function(a){typeof a=="number"&&(this._r=a)},get:function(){return this._r}});var d=function(a){var c;c=0,typeof a[c]=="number"?this.a=a[c++]:this.a=0,typeof a[c]=="number"?this.d=a[c++]:this.d=0,typeof a[c]=="number"?this.s=a[c++]:this.s=0,typeof a[c]=="number"?this.r=a[c++]:this.r=0,typeof a[c]=="number"&&(this.mul=a[c++]),typeof a[c]=="number"&&(this.add=a[c++]),this._mode=0,this._samplesMax=b.samplerate*(this._a/1e3)|0,this._samples=0};c.clone=function(){return new a([this.a,this.d,this.s,this.r,this.mul,this.add])},c.bang=c.keyOn=function(){this._mode=0,this._samplesMax=b.samplerate*(this._a/1e3)|0,this._samples=0,b.fn.do_event(this,"bang"),b.fn.do_event(this,"A");return this},c.keyOff=function(){this._mode=3,this._samples=0,this._samplesMax=b.samplerate*(this._r/1e3)|0,b.fn.do_event(this,"R");return this},c.seq=function(a){var c,d,e,f,g,h,i,j,k,l,m;c=this._cell;if(a!==this._seq_id){d=this._mode,e=this._samples,f=this._samplesMax,g=this._mul,h=this._add,i=this._s,j=1-this._s;while(e>=f){if(d===0){this._mode=1,this._samples-=f,this._samplesMax=b.samplerate*(this._d/1e3)|0,b.fn.do_event(this,"D"),d=this._mode,f=this._samplesMax,e=this._samples;continue}if(d===1){if(i===0){d=3;continue}this._mode=2,this._samples=0,this._samplesMax=Infinity,b.fn.do_event(this,"S"),d=this._mode,f=this._samplesMax,e=this._samples;continue}if(d===3){this._mode=4,this._samples=0,this._samplesMax=Infinity,b.fn.do_event(this,"ended"),d=this._mode,f=this._samplesMax,e=this._samples;continue}}switch(d){case 0:k=e/f;break;case 1:k=e/f,k=(1-k)*j+i;break;case 2:k=i;break;case 3:k=e/f,k=(1-k)*i;break;default:k=0}k=k*g+h;for(l=0,m=c.length;l<m;++l)c[l]=k;this._mode=d,this._samples=e+m,this._samplesMax=f}return c};return a}();b.fn.register("adsr",o);var p=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"type",{set:function(b){var c;typeof b=="string"&&(c=a.functions[b])!==undefined&&(this._type=b,this._func=c)},get:function(){return this._type}}),Object.defineProperty(c,"d",{set:function(a){typeof a=="number"&&(this._d=a)},get:function(){return this._d}}),Object.defineProperty(c,"start",{set:function(a){typeof a=="number"&&(this._start=a)},get:function(){return this._start}}),Object.defineProperty(c,"stop",{set:function(a){typeof a=="number"&&(this._stop=a)},get:function(){return this._stop}});var d=function(b){var c,d;c=0,typeof b[c]=="string"&&a.functions[b[c]]!==undefined?d=b[c++]:d="linear",typeof b[c]=="number"?this.d=b[c++]:this.d=1e3,typeof b[c]=="number"?this.start=b[c++]:this.start=0,typeof b[c]=="number"?this.stop=b[c++]:this.stop=1,typeof b[c]=="number"&&(this.mul=b[c++]),typeof b[c]=="number"&&(this.add=b[c++]),this._phase=0,this._phaseStep=0,this._value=0,this._enabled=!1,this.type=d};c.clone=function(){return new a([this.type,this.d,this.start,this.stop,this.mul,this.add])},c.bang=function(){var a;a=this._stop-this._start,this._phase=0,this._phaseStep=b.cellsize/(this._d/1e3*b.samplerate),this._value=this._func(0)*a+this._start,this._enabled=!0;return this},c.seq=function(a){var c,d,e,f,g,h,i;c=this._cell;if(a!==this._seq_id){this._enabled?(this._phase+=this._phaseStep,this._phase<1?g=!1:(this._phase=1,this._enabled=!1,g=!0),e=this._stop-this._start,this._value=this._func(this._phase)*e+this._start,f=!0):f=!1,d=this._value*this._mul+this._add;for(h=0,i=b.cellsize;h<i;++h)c[h]=d;f&&this.onchanged&&this.onchanged(this._value),g&&b.fn.do_event(this,"ended")}return c};return a}();b.fn.register("tween",p),p.functions={linear:function(a){return a},"quadratic.in":function(a){return a*a},"quadratic.out":function(a){return a*(2-a)},"quadratic.inout":function(a){if((a*=2)<1)return.5*a*a;return-0.5*(--a*(a-2)-1)},"cubic.in":function(a){return a*a*a},"cubic.out":function(a){return--a*a*a+1},"cubic.inout":function(a){if((a*=2)<1)return.5*a*a*a;return.5*((a-=2)*a*a+2)},"quartic.in":function(a){return a*a*a*a},"quartic.out":function(a){return 1- --a*a*a*a},"quartic.inout":function(a){if((a*=2)<1)return.5*a*a*a*a;return-0.5*((a-=2)*a*a*a-2)},"quintic.in":function(a){return a*a*a*a*a},"quintic.out":function(a){return--a*a*a*a*a+1},"quintic.inout":function(a){if((a*=2)<1)return.5*a*a*a*a*a;return.5*((a-=2)*a*a*a*a+2)},"sinusoidal.in":function(a){return 1-Math.cos(a*Math.PI/2)},"sinusoidal.out":function(a){return Math.sin(a*Math.PI/2)},"sinusoidal.inout":function(a){return.5*(1-Math.cos(Math.PI*a))},"exponential.in":function(a){return a===0?0:Math.pow(1024,a-1)},"exponential.out":function(a){return a===1?1:1-Math.pow(2,-10*a)},"exponential.inout":function(a){if(a===0)return 0;if(a===1)return 1;if((a*=2)<1)return.5*Math.pow(1024,a-1);return.5*(-Math.pow(2,-10*(a-1))+2)},"circular.in":function(a){return 1-Math.sqrt(1-a*a)},"circular.out":function(a){return Math.sqrt(1- --a*a)},"circular.inout":function(a){if((a*=2)<1)return-0.5*(Math.sqrt(1-a*a)-1);return.5*(Math.sqrt(1-(a-=2)*a)+1)},"elastic.in":function(a){var b,c=.1,d=.4;if(a===0)return 0;if(a===1)return 1;!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI);return-(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/d))},"elastic.out":function(a){var b,c=.1,d=.4;if(a===0)return 0;if(a===1)return 1;!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI);return c*Math.pow(2,-10*a)*Math.sin((a-b)*2*Math.PI/d)+1},"elastic.inout":function(a){var b,c=.1,d=.4;if(a===0)return 0;if(a===1)return 1;!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI);if((a*=2)<1)return-0.5*c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/d);return c*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*2*Math.PI/d)*.5+1},"back.in":function(a){var b=1.70158;return a*a*((b+1)*a-b)},"back.out":function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},"back.inout":function(a){var b=2.5949095;if((a*=2)<1)return.5*a*a*((b+1)*a-b);return.5*((a-=2)*a*((b+1)*a+b)+2)},"bounce.in":function(a){return 1-p.functions["bounce.out"](1-a)},"bounce.out":function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},"bounce.inout":function(a){if(a<.5)return p.functions["bounce.in"](a*2)*.5;return p.functions["bounce.out"](a*2-1)*.5+.5}};var q=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"d",{set:function(a){typeof a=="number"&&(this._d=a)},get:function(){return this._d}});var d=function(a){var c;c=0,typeof a[c]=="number"?this.d=a[c++]:this.d=100,typeof a[c]=="number"&&(this.mul=a[c++]),typeof a[c]=="number"&&(this.add=a[c++]),typeof a[c]=="function"&&(this.onended=a[c++]),this._samples=0,this._dx=b.cellsize/this._samples,this._x=0};c.clone=function(){return new a([this.d,this.mul,this.add])},c.bang=function(){this._samples=b.samplerate*(this._d/1e3)|0,this._dx=b.cellsize/this._samples,this._x=1,b.fn.do_event(this,"bang");return this},c.seq=function(a){var c,d,e,f,g,h,i;c=this._cell;if(a!==this._seq_id){e=this._x,f=this._dx,g=this._samples,d=e*this._mul+this._add;for(h=0,i=c.length;h<i;++h)c[h]=d;e-=f,e<0&&(e=0),g>0&&(g-=i,g<=0&&(this._samples=0,b.fn.do_event(this,"ended"),e=this._x,g=this._samples)),this._x=e,this._samples=g}return c};return a}();b.fn.register("perc",q);var r=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"type",{set:function(b){var c;typeof b=="string"&&(c=a.types[b])!==undefined&&(this._type=b,this._set_params=c.set_params)},get:function(){return this._type}}),Object.defineProperty(c,"freq",{set:function(a){typeof a!="object"?this._freq=b(a):this._freq=a},get:function(){return this._freq}}),Object.defineProperty(c,"band",{set:function(a){typeof a!="object"?this._band=b(a):this._band=a},get:function(){return this._band}}),Object.defineProperty(c,"gain",{set:function(a){typeof a!="object"?this._gain=b(a):this._gain=a},get:function(){return this._gain}});var d=function(c){var d,e;this._mul=1,this._add=0,d=0,typeof c[d]=="string"&&a.types[c[d]]!==undefined?this.type=c[d++]:this.type="LPF",e=this._type,typeof c[d]=="object"&&!c[d]._ar?this._freq=c[d++]:typeof c[d]=="number"?this._freq=b(c[d++]):this._freq=b(a.types[e].default_freq),typeof c[d]=="object"&&!c[d]._ar?this._band=c[d++]:typeof c[d]=="number"?this._band=b(c[d++]):this._band=b(a.types[e].default_band),e==="peaking"||e==="lowboost"||e==="highboost"?typeof c[d]=="object"&&!c[d]._ar?this._gain=c[d++]:typeof c[d]=="number"?this._gain=b(c[d++]):this._gain=b(a.types[e].default_gain):this._gain=b(undefined),typeof c[d]=="number"&&(this._mul=c[d++]),typeof c[d]=="number"&&(this._add=c[d++]),this.args=b.fn.valist.call(this,c.slice(d)),this._prev_type=undefined,this._prev_freq=undefined,this._prev_band=undefined,this._prev_gain=undefined,this._ison=!0,this._in1=this._in2=this._out1=this._out2=0};c._ar=!0,c.on=function(){this._ison=!0,b.fn.do_event(this,"on");return this},c.off=function(){this._ison=!1,b.fn.do_event(this,"off");return this},c.seq=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;c=this._cell;if(a!==this._seq_id){b=this.args;for(m=n=c.length;m--;)c[m]=0;for(k=b.length;k--;){j=b[k].seq(a);for(m=n;m--;)c[m]+=j[m]}if(this._ison){f=this._type,g=this._freq.seq(a)[0],h=this._band.seq(a)[0],i=this._gain.seq(a)[0];if(f!==this._prev_type||g!==this._prev_freq||h!==this._prev_band||i!==this._prev_gain)this._set_params(g,h,i),this._prev_type=f,this._prev_freq=g,this._prev_band=h,this._prev_gain=i;d=this._mul,e=this._add,o=this._a1,p=this._a2,q=this._b0,r=this._b1,s=this._b2,t=this._in1,u=this._in2,v=this._out1,w=this._out2;for(k=0,l=c.length;k<l;++k)x=c[k],y=q*x+r*t+s*u-o*v-p*w,y>1?y=1:y<-1&&(y=-1),u=t,t=x,w=v,v=y,c[k]=y*d+e;this._in1=t,this._in2=u,this._out1=v,this._out2=w}this._seq_id=a}return c};return a}();r.types={},r.types.LPF={default_freq:800,default_band:1,set_params:function(a,c){var d,e,f,g,h,i;d=a*2*Math.PI/b.samplerate,e=Math.cos(d),f=Math.sin(d),h=.34657359027997264*c*d/f,g=f*(Math.exp(h)-Math.exp(-h))*.5,i=1/(1+g),this._a1=-2*e*i,this._a2=(1-g)*i,this._b1=(1-e)*i,this._b2=this._b0=this._b1*.5}},r.types.HPF={default_freq:5500,default_band:1,set_params:function(a,c){var d,e,f,g,h,i;d=a*2*Math.PI/b.samplerate,e=Math.cos(d),f=Math.sin(d),h=.34657359027997264*c*d/f,g=f*(Math.exp(h)-Math.exp(-h))*.5,i=1/(1+g),this._a1=-2*e*i,this._a2=+(1-g)*i,this._b1=-(1+e)*i,this._b2=this._b0=-this._b1*.5}},r.types.BPF={default_freq:3e3,default_band:1,set_params:function(a,c){var d,e,f,g,h,i;d=a*2*Math.PI/b.samplerate,e=Math.cos(d),f=Math.sin(d),h=.34657359027997264*c*d/f,g=f*(Math.exp(h)-Math.exp(-h))*.5,i=1/(1+g),this._a1=-2*e*i,this._a2=(1-g)*i,this._b0=g*i,this._b1=0,this._b2=-this._b0}},r.types.BRF={default_freq:3e3,default_band:1,set_params:function(a,c){var d,e,f,g,h,i;d=a*2*Math.PI/b.samplerate,e=Math.cos(d),f=Math.sin(d),h=.34657359027997264*c*d/f,g=f*(Math.exp(h)-Math.exp(-h))*.5,i=1/(1+g),this._a1=-2*e*i,this._a2=+(1-g)*i,this._b0=1,this._b1=-(1+e)*i,this._b2=1}},r.types.allpass={default_freq:3e3,default_band:1,set_params:function(a,c){var d,e,f,g,h,i;d=a*2*Math.PI/b.samplerate,e=Math.cos(d),f=Math.sin(d),h=.34657359027997264*c*d/f,g=f*(Math.exp(h)-Math.exp(-h))*.5,i=1/(1+g),this._a1=-2*e*i,this._a2=+(1-g)*i,this._b0=this._a2,this._b1=this._a1,this._b2=1}},r.types.peaking={default_freq:3e3,default_band:1,default_gain:6,set_params:function(a,c,d){var e,f,g,h,i,j,k,l,m;e=Math.pow(10,d*.025),f=a*2*Math.PI/b.samplerate,g=Math.cos(f),h=Math.sin(f),l=.34657359027997264*c*f/h,i=h*(Math.exp(l)-Math.exp(-l))*.5,j=i*e,k=i/e,m=1/(1+k),this._a1=-2*g*m,this._a2=+(1-k)*m,this._b0=+(1+j)*m,this._b1=this._a1,this._b2=+(1-j)*m}},r.types.lowboost={default_freq:3e3,default_band:1,default_gain:6,set_params:function(a,c,d){var e,f,g,h,i,j,k;e=Math.pow(10,d*.025),f=a*2*Math.PI/b.samplerate,g=Math.cos(f),h=Math.sin(f),i=h*.5*Math.sqrt((e+1/e)*(1/c-1)+2),j=i*Math.sqrt(e)*2,k=1/(e+1+(e-1)*g+j),this._a1=-2*(e-1+(e+1)*g)*k,this._a2=(e+1+(e-1)*g-j)*k,this._b0=(e+1-(e-1)*g+j)*e*k,this._b1=2*(e-1-(e+1)*g)*e*k,this._b2=(e+1-(e-1)*g-j)*e*k}},r.types.highboost={default_freq:5500,default_band:1,default_gain:6,set_params:function(a,c,d){var e,f,g,h,i,j,k;e=Math.pow(10,d*.025),f=a*2*Math.PI/b.samplerate,g=Math.cos(f),h=Math.sin(f),i=h*.5*Math.sqrt((e+1/e)*(1/c-1)+2),j=i*Math.sqrt(e)*2,k=1/(e+1+(e-1)*g+j),this._a1=2*(e-1+(e+1)*g)*k,this._a2=(e+1+(e-1)*g-j)*k,this._b0=(e+1-(e-1)*g+j)*e*k,this._b1=-2*(e-1-(e+1)*g)*e*k,this._b2=(e+1-(e-1)*g-j)*e*k}},b.fn.register("LPF",r,function(a){return new r(["LPF"].concat(a))}),b.fn.register("HPF",r,function(a){return new r(["HPF"].concat(a))}),b.fn.register("BPF",r,function(a){return new r(["BPF"].concat(a))}),b.fn.register("BRF",r,function(a){return new r(["BRF"].concat(a))}),b.fn.register("allpass",r,function(a){return new r(["allpass"].concat(a))}),b.fn.register("peaking",r,function(a){return new r(["peaking"].concat(a))}),b.fn.register("lowboost",r,function(a){return new r(["lowboost"].concat(a))}),b.fn.register("highboost",r,function(a){return new r(["highboost"].concat(a))});var s=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;a.types={LPF:0,HPF:1,BPF:2,BRF:3},Object.defineProperty(c,"type",{set:function(b){var c;typeof b=="string"&&(c=a.types[b])!==undefined&&(this._type=b,this._mode=c)},get:function(){return this._type}}),Object.defineProperty(c,"cutoff",{set:function(a){typeof a!="object"?this._cutoff=b(a):this._cutoff=a},get:function(){return this._cutoff}}),Object.defineProperty(c,"Q",{set:function(a){typeof a!="object"?this._Q=b(a):this._Q=a},get:function(){return this._Q}}),Object.defineProperty(c,"depth",{set:function(a){typeof a!="object"?this._depth=b(a):this._depth=a},get:function(){return this._depth}});var d=function(c){var d,e;d=0,typeof c[d]=="string"&&a.types[c[d]]!==undefined?this.type=c[d++]:this.type="LPF",typeof c[d]=="object"&&!c[d]._ar?this._cutoff=c[d++]:typeof c[d]=="number"?this._cutoff=b(c[d++]):this._cutoff=b(800),typeof c[d]=="object"&&!c[d]._ar?this._Q=c[d++]:typeof c[d]=="number"?this._Q=b(c[d++]):this._Q=b(.5),typeof c[d]=="object"&&!c[d]._ar?this._depth=c[d++]:typeof c[d]=="number"?this._depth=b(c[d++]):this._depth=b(.5),typeof c[d]=="number"&&(this.mul=c[d++]),typeof c[d]=="number"&&(this.add=c[d++]),this.args=b.fn.valist.call(this,c.slice(d)),this._prev_cutoff=undefined,this._prev_Q=undefined,this._prev_depth=undefined,this._ison=!0,this._f=new Float32Array(4),this._mode=0,this._damp=0,this._freq=0};c._ar=!0,c._set_params=function(a,c){var d=2*Math.sin(Math.PI*Math.min(.25,a/(b.samplerate*2)));this._damp=Math.min(2*(1-Math.pow(c,.25)),Math.min(2,2/d-d*.5)),this._freq=d},c.on=function(){this._ison=!0,b.fn.do_event(this,"on");return this},c.off=function(){this._ison=!1,b.fn.do_event(this,"off");return this},c.seq=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;c=this._cell;if(a!==this._seq_id){b=this.args;for(k=l=c.length;k--;)c[k]=0;for(i=b.length;i--;){h=b[i].seq(a);for(k=l;k--;)c[k]+=h[k]}if(this._ison){n=this._mode,f=this._cutoff.seq(a)[0],g=this._Q.seq(a)[0];if(f!==this._prev_cutoff||g!==this._prev_Q)this._set_params(f,g),this._prev_cutoff=f,this._prev_Q=g;q=this._depth.seq(a)[0],q!==this._prev_depth&&(this._depth0=Math.cos(.5*Math.PI*q),this._depth1=Math.sin(.5*Math.PI*q)),d=this._mul,e=this._add,m=this._f,o=this._damp,p=this._freq,r=this._depth0,s=this._depth1;for(i=0,j=c.length;i<j;++i)t=c[i],m[3]=t-o*m[2],m[0]=m[0]+p*m[2],m[1]=m[3]-m[0],m[2]=p*m[1]+m[2],u=.5*m[n],m[3]=t-o*m[2],m[0]=m[0]+p*m[2],m[1]=m[3]-m[0],m[2]=p*m[1]+m[2],u+=.5*m[n],u=t*r+u*s,c[i]=u*d+e}this._seq_id=a}return c};return a}();b.fn.register("rLPF",s,function(a){return new s(["LPF"].concat(a))}),b.fn.register("rHPF",s,function(a){return new s(["HPF"].concat(a))}),b.fn.register("rBPF",s,function(a){return new s(["BPF"].concat(a))}),b.fn.register("rBRF",s,function(a){return new s(["BRF"].concat(a))});var t=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"pre",{set:function(a){typeof a!="object"?this._preGain=b(a):this._preGain=a},get:function(){return this._preGain}}),Object.defineProperty(c,"post",{set:function(a){typeof a!="object"?this._postGain=b(a):this._postGain=a},get:function(){return this._postGain}}),Object.defineProperty(c,"freq",{set:function(a){typeof a!="object"?this._lpfFreq=b(a):this._lpfFreq=a},get:function(){return this._lpfFreq}}),Object.defineProperty(c,"slope",{set:function(a){typeof a!="object"?this._lpfSlope=b(a):this._lpfSlope=a},get:function(){return this._lpfSlope}}),Object.defineProperty(c,"isEnabled",{get:function(){return this._enabled}});var d=function(a){var c;c=0,typeof a[c]=="object"&&!a[c]._ar?this._preGain=a[c++]:typeof a[c]=="number"?this._preGain=b(a[c++]):this._preGain=b(-60),typeof a[c]=="object"&&!a[c]._ar?this._postGain=a[c++]:typeof a[c]=="number"?this._postGain=b(a[c++]):this._postGain=b(18),typeof a[c]=="object"&&!a[c]._ar?this._lpfFreq=a[c++]:typeof a[c]=="number"?this._lpfFreq=b(a[c++]):this._lpfFreq=b(2400),typeof a[c]=="object"&&!a[c]._ar?this._lpfSlope=a[c++]
:typeof a[c]=="number"?this._lpfSlope=b(a[c++]):this._lpfSlope=b(1),typeof a[c]=="number"&&(this._mul=a[c++]),typeof a[c]=="number"&&(this._add=a[c++]),this._prev_preGain=undefined,this._prev_postGain=undefined,this._prev_lpfFreq=undefined,this._prev_lpfSlope=undefined,this._in1=this._in2=this._out1=this._out2=0,this._a1=this._a2=0,this._b0=this._b1=this._b2=0,this.args=b.fn.valist.call(this,a.slice(c)),this._enabled=!0};c._ar=!0;var e=152587890625e-16;c._set_params=function(a,c,d,e){var f,g,h,i,j,k,l;f=Math.pow(2,-c/6),this._preScale=Math.pow(2,-a/6)*f,this._limit=f,d&&(g=d*2*Math.PI/b.samplerate,h=Math.cos(g),i=Math.sin(g),k=.34657359027997264*e*g/i,j=i*(Math.exp(k)-Math.exp(-k))*.5,l=1/(1+j),this._a1=-2*h*l,this._a2=(1-j)*l,this._b1=(1-h)*l,this._b2=this._b0=this._b1*.5)},c.on=function(){this._enabled=!0,b.fn.do_event(this,"on");return this},c.off=function(){this._enabled=!1,b.fn.do_event(this,"off");return this},c.seq=function(a){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;b=this._cell;if(a!==this._seq_id){c=this.args;for(h=i=b.length;h--;)b[h]=0;for(f=c.length;f--;){d=c[f].seq(a);for(h=i;h--;)b[h]+=d[h]}if(this._enabled){j=this._preGain.seq(a)[0],k=this._postGain.seq(a)[0],l=this._lpfFreq.seq(a)[0],m=this._lpfSlope.seq(a)[0],(j!==this._prev_preGain||k!==this._prev_postGain||l!==this._prev_lpfFreq||m!==this._prev_lpfSlope)&&this._set_params(j,k,l,m),n=this._preScale,o=this._limit,p=this._mul,q=this._add;if(this._lpfFreq){r=this._a1,s=this._a2,t=this._b0,u=this._b1,v=this._b2,w=this._in1,x=this._in2,y=this._out1,z=this._out2,y<e&&(z=y=0);for(f=0,g=b.length;f<g;++f)A=b[f]*n,A>o?A=o:A<-o&&(A=-o),B=t*A+u*w+v*x-r*y-s*z,B>1?B=1:B<-1&&(B=-1),x=w,w=A,z=y,y=B,b[f]=B*p+q;this._in1=w,this._in2=x,this._out1=y,this._out2=z}else for(f=0,g=b.length;f<g;++f)A=b[f]*n,A>o?A=o:A<-o&&(A=-o),b[f]=A*p+q}}return b};return a}();b.fn.register("efx.dist",t);var u=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"time",{set:function(a){typeof a=="number"&&(this._delayTime=a)},get:function(){return this._delayTime}}),Object.defineProperty(c,"fb",{set:function(a){typeof a=="number"&&(this._feedback=a)},get:function(){return this._feedback}}),Object.defineProperty(c,"wet",{set:function(a){typeof a=="number"&&(this._wet=a)},get:function(){return this._wet}});var d=function(a){var c,d;d=Math.ceil(Math.log(b.samplerate*1.5)*Math.LOG2E),this._buffer=new Float32Array(1<<d),this._buffer_mask=(1<<d)-1,this._pointerWrite=0,this._pointerRead=0,this._delayTime=250,this._feedback=.25,this._wet=.25,c=0,typeof a[c]=="number"&&(this._delayTime=a[c++]),typeof a[c]=="number"&&(this._feedback=a[c++]),typeof a[c]=="number"&&(this._wet=a[c++]),this._set_params(this._delayTime,this._feedback,this._wet),this.args=b.fn.valist.call(this,a.slice(c)),this._enabled=!0};c._set_params=function(a,c,d){var e;e=a*b.samplerate/1e3,this._pointerWrite=this._pointerRead+e&this._buffer_mask,c<1?c>-1?this._feedback=c:this._feedback=-0.9990234375:this._feedback=.9990234375,d<0?this._wet=0:d>1?this._wet=1:this._wet=d},c.on=function(){this._enabled=!0,b.fn.do_event(this,"on");return this},c.off=function(){this._enabled=!1,b.fn.do_event(this,"off");return this},c.seq=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;c=this._cell;if(a!==this._seq_id){b=this.args;for(g=h=c.length;g--;)c[g]=0;for(e=b.length;e--;){d=b[e].seq(a);for(g=h;g--;)c[g]+=d[g]}o=this._buffer,p=this._buffer_mask,l=this._feedback,m=this._wet,n=1-m,q=this._pointerRead,r=this._pointerWrite,i=this._mul,j=this._add;if(this._enabled)for(e=0,f=c.length;e<f;++e)k=o[q],o[r]=c[e]-k*l,c[e]*=n,c[e]+=k*m,c[e]=c[e]*i+j,r=r+1&p,q=q+1&p;else for(e=0,f=c.length;e<f;++e)k=o[q],o[r]=c[e]-k*l,r=r+1&p,q=q+1&p,c[e]=c[e]*i+j;this._pointerRead=q,this._pointerWrite=r,this._seq_id=a}return c};return a}();b.fn.register("efx.delay",u);var v=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"interval",{set:function(a){typeof a=="number"&&(this._interval=a,this._interval_samples=b.samplerate*(a/1e3)|0)},get:function(){return this._interval}}),Object.defineProperty(c,"isOn",{get:function(){return this._ison}}),Object.defineProperty(c,"isOff",{get:function(){return!this._ison}});var d=function(a){var b;this._interval_samples=0,b=0,typeof a[b]=="number"&&(this.interval=a[b++]),this.args=a.slice(b),this._ison=!1,this._samples=0,this._interval_count=0};c._raw_args=!0,c.on=function(){this._ison=!0,this._samples=0,b.timers.append(this),b.fn.do_event(this,"on");return this},c.off=function(){this._ison=!1,b.timers.remove(this),b.fn.do_event(this,"off");return this},c.play=c.pause=function(){return this},c.bang=function(){this._ison&&(this._samples=0,this._interval_count=0,b.fn.do_event(this,"bang"));return this},c.seq=function(a){var c,d,e,f,g;if(a!==this._seq_id){if(this._interval_samples!==0){c=this._samples-b.cellsize;if(c<=0){this._samples=c+this._interval_samples,d=this._interval_count,e=this.args;for(f=0,g=e.length;f<g;++f)typeof e[f]=="function"?e[f](d):e[f].bang==="function"&&e[f].bang();++this._interval_count,c=this._samples}this._samples=c}this._seq_id=a}return this._cell};return a}();b.fn.register("interval",v);var w=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"timeout",{set:function(a){typeof a=="number"&&(this._timeout=a,this._timeout_samples=b.samplerate*(a/1e3)|0)},get:function(){return this._timeout}}),Object.defineProperty(c,"isOn",{get:function(){return this._ison}}),Object.defineProperty(c,"isOff",{get:function(){return!this._ison}});var d=function(a){var b;this._timeout_samples=0,b=0,typeof a[b]=="number"&&(this.timeout=a[b++]),this.args=a.slice(b),this._ison=!1,this._samples=0};c._raw_args=!0,c.on=function(){this._ison=!0,this._samples=this._timeout_samples,b.timers.append(this),b.fn.do_event(this,"on");return this},c.off=function(){this._ison=!1,b.timers.remove(this),b.fn.do_event(this,"off");return this},c.play=c.pause=function(){return this},c.bang=function(){this._ison&&(this._samples=this._timeout_samples,b.fn.do_event(this,"bang"));return this},c.seq=function(a){var c,d,e,f;if(a!==this._seq_id){if(this._timeout_samples!==0){c=this._samples-b.cellsize;if(c<=0){this._samples=0,d=this.args;for(e=0,f=d.length;e<f;++e)typeof d[e]=="function"?d[e]():d[e].bang==="function"&&d[e].bang();c=this._samples,c<=0&&this.off()}this._samples=c}this._seq_id=a}return this._cell};return a}();b.fn.register("timeout",w);var x=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"mode",{get:function(){return this._mode}}),Object.defineProperty(c,"isOn",{get:function(){return this._ison}}),Object.defineProperty(c,"isOff",{get:function(){return!this._ison}});var d=function(a){var b,c,d;this._mode="msec",this._msec=1,this._timetable=[],this._index=0,this._init=!0,b=0,typeof a[b]=="string"&&e.call(this,a[b++]);if(typeof a[b]=="object"&&a[b]instanceof Array){c=a[b++];for(d=c.length;d--;)this.append(c[d]);this._timetable.sort(function(a,b){return a[0]-b[0]})}typeof a[b]=="boolean"?this._loop=a[b++]:this._loop=!1,this._ison=!1,this._currentTime=0,this._loopcount=0,delete this._init};c._raw_args=!0;var e=function(a){var c;if(c=/^bpm\s*\(\s*(\d+(?:\.\d*)?)\s*(?:,\s*(\d+))?\s*\)/.exec(a))this._mode="bpm",this._msec=b.utils.bpm2msec(c[1],c[2]||16)};c.on=function(){this._ison=!0,this._index=0,this._currentTime=0,this._loopcount=0,b.timers.append(this),b.fn.do_event(this,"on");return this},c.off=function(){this._ison=!1,this._index=0,this._currentTime=0,this._loopcount=0,b.timers.remove(this),b.fn.do_event(this,"off");return this},c.play=function(){this._ison=!0,b.fn.do_event(this,"play");return this},c.pause=function(){this._ison=!1,b.fn.do_event(this,"pause");return this},c.bang=function(){this._ison&&(this._index=0,this._currentTime=0,this._loopcount=0,b.fn.do_event(this,"bang"));return this},c.append=function(a){var b,c;if(typeof a!="object")return this;if(!(a instanceof Array))return this;if(a.length===0)return this;b=this._timetable,c=b[this._index],a[0]*=this._msec,b.push(a),this._init||(c&&a[0]<c[0]&&(this._index+=1),b.sort(function(a,b){return a[0]-b[0]}));return this},c.remove=function(a){var b,c;if(typeof a!="object")return this;if(!(a instanceof Array))return this;if(a.length===0)return this;b=this._timetable,schedule=b[this._index],a[0]*=this._msec,c=0;for(i=b.length;i--;)b[i][0]===a[0]&&b[i][1]==a[1]&&b[i][2]===a[2]&&(b.slice(i,1),c+=1);schedule&&schedule[0]<a[0]&&(this._index-=c);return this},c.seq=function(a){var c,d,e;if(a!==this._seq_id){if(this._ison){c=this._timetable;while((d=c[this._index])!==undefined){if(this._currentTime<d[0])break;(e=d[1])!==undefined&&(typeof e=="function"?e.apply(e,d[2]):typeof e.bang=="function"&&e.bang&&e.bang()),++this._index>=c.length&&this._index>=c.length&&(this._loop?(b.fn.do_event(this,"looped",[++this._loopcount]),this._index=0,this._currentTime-=d[0]):(b.fn.do_event(this,"ended"),this.off()))}this._currentTime+=b.cellsize/b.samplerate*1e3}this._seq_id=a}return this._cell};return a}();b.fn.register("schedule",x);var y=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;Object.defineProperty(c,"src",{set:function(a){typeof a=="string"&&(this._src=a)},get:function(){return this._src}}),Object.defineProperty(c,"loop",{set:function(a){typeof a=="boolean"&&(this._loop=a)},get:function(){return this._loop}}),Object.defineProperty(c,"duration",{get:function(){return this._duration}}),Object.defineProperty(c,"currentTime",{set:function(a){typeof a=="number"&&0<=a&&a<=this._duration&&(this._phase=a/1e3*this._samplerate)},get:function(){return this._phase/this._samplerate*1e3}});var d=function(a){var b;b=0,typeof a[b]=="string"?this._src=a[b++]:this._src="",typeof a[b]=="boolean"?this._loop=a[b++]:this._loop=!1,this._loaded_src=undefined,this._buffer=new Int16Array(0),this._samplerate=0,this._duration=0,this._phaseStep=0,this._phase=0};c._ar=!0;var e=function(a,c){typeof c=="function"?c.call(this,a):typeof c=="object"&&a.buffer&&(c.self=this,c.samplerate=a.samplerate,c.duration=a.buffer.length/samplerate*1e3,c.buffer=a.buffer,console.log("wav.load: done.")),b.fn.do_event(this,"loadend",[a])};c.load=function(a){var c=this,d,f,g,h,i;this._loaded_src===this._src?e.call(this,{samplerate:this._samplerate,buffer:this._buffer},a):this._src!==""?(b.fn.do_event(this,"loading"),b.platform==="web"&&b.workerpath?(f=this._src,(g=/^(?:\.)(.*)$/.exec(f))!==null&&(f=location.pathname,f=f.substr(0,f.lastIndexOf("/")),f+=g[1]),d=new Worker(b.workerpath),d.onmessage=function(d){var f=d.data;switch(f.result){case"metadata":h=new Int16Array(f.bufferSize),i=f.samplerate;break;case"data":h.set(f.array,f.offset);break;case"ended":c._loaded_src=c._src,c._buffer=h,c._samplerate=i,c._duration=h.length/i*1e3,c._phaseStep=i/b.samplerate,c._phase=0,e.call(c,{samplerate:i,buffer:h},a);break;default:e.call(c,f,a)}},d.postMessage({action:"wav.decode",src:f})):b.utils.binary.load(this._src,function(d){b.utils.wav.decode(d,function(d){d&&(c._loaded_src=c._src,c._buffer=d.buffer,c._samplerate=d.samplerate,c._duration=d.buffer.length/d.samplerate*1e3,c._phaseStep=d.samplerate/b.samplerate,c._phase=0,e.call(c,{samplerate:d.samplerate,buffer:d.buffer},a))})})):e.call(this,{},a);return this},c.clone=function(){var a;a=b("wav"),a._src=this._src,a._loop=this._loop,a._loaded_src=this._loaded_src,a._buffer=this._buffer,a._samplerate=this._samplerate,a._duration=this._duration,a._phaseStep=this._phaseStep,a._phase=0,a._mul=this._mul,a._add=this._add;return a},c.slice=function(a,c){var d,e;typeof a=="number"?a=a/1e3*this._samplerate:a=0,typeof c=="number"?c=c/1e3*this._samplerate:c=this._buffer.length,a>c&&(e=a,a=c,c=e),d=b("wav"),d._src=this._src,d._loop=this._loop,d._loaded_src=this._loaded_src,d._buffer=this._buffer.subarray(a,c),d._samplerate=this._samplerate,d._duration=(c-a/this._samplerate)*1e3,d._phaseStep=this._phaseStep,d._phase=0,d._mul=this._mul,d._add=this._add;return d},c.bang=function(){this._phase=0,b.fn.do_event(this,"bang");return this},c.seq=function(a){var c,d,e,f,g,h,i,j,k,l,m,n;c=this._cell;if(a!==this._seq_id){d=this._mul,e=this._add,f=this._buffer,g=this._phase,h=this._phaseStep;for(m=0,n=c.length;m<n;++m)i=g|0,j=g-i,k=(f[i]||0)/32768,l=(f[i+1]||0)/32768,c[m]=((1-j)*k+j*l)*d+e,g+=h,f.length<=g&&(this._loop?(g=0,b.fn.do_event(this,"looped")):b.fn.do_event(this,"ended"));this._phase=g,this._seq_id=a}return c};return a}();b.fn.register("wav",y),b.utils=function(a){var b={$exports:{}};b._1st=1,b._2nd=Math.pow(2,2/12),b._3rd=Math.pow(2,4/12),b._4th=Math.pow(2,5/12),b._5th=Math.pow(2,7/12),b._6th=Math.pow(2,.75),b._7th=Math.pow(2,11/12),b._1oct=2,b._9th=Math.pow(2,14/12),b._11th=Math.pow(2,17/12),b._13th=Math.pow(2,1.75),b.$exports.tension=["_1st","_2nd","_3rd","_4th","_5th","_6th","_7th","_1oct","_9th","_11th","_13th"],b.mtof=function(){var a=function(){var a,b;a=new Float32Array(128);for(b=0;b<128;b++)a[b]=440*Math.pow(Math.pow(2,1/12),b-69);return a}();return function(b){return 0<=b&&b<128?a[b|0]:0}}(),b.ftom=function(a){return Math.round(Math.log(a/440)*Math.LOG2E*12+69)},b.mtoa=function(){var a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return function(b){var c,d;c=(b|0)%12,d=(b|0)/12;return a[c]+((d|0)-2)}}(),b.ftoa=function(a){return mtoa(ftom(a))},b.atom=function(){var a=/^([CDEFGAB])([-+#b]?)([0-9]?)$/,b={C:0,D:2,E:4,F:5,G:7,A:9,B:11};return function(c){var d,e;e=0;if((d=c.match(a))!==null){e=b[d[1]];switch(d[2]){case"+":case"#":++e;break;case"-":case"b":--e}e+=12*((d[3]|0)+2)}return e}}(),b.atof=function(a){return mtof(atom(a))},b.bpm2msec=function(a,b){typeof b=="undefined"&&(b=4);return 60/a*(4/b)*1e3},b.msec2bpm=function(a,b){typeof b=="undefined"&&(b=4);return 60/(a/1e3)*(4/b)},b.msec2Hz=function(a){return 1e3/a},b.msec2Hz=function(a){return 1e3/a},b.wavb=function(a){var b,c,d,e,f,g;b=new Float32Array(1024);for(c=f=0,d=a.length/2;c<d;++c){g=parseInt(a.substr(c*2,2),16),g=g&128?(g-256)/128:g/127;for(e=1024/d;e--;)b[f++]=g}return b},b.$exports.converter=["mtof","ftom","mtoa","ftoa","atom","atof","bpm2msec","msec2bpm","msec2Hz","msec2Hz","wavb"],function(b){var c=function(a,b){typeof a=="function"?a(b):typeof a=="object"&&(a.buffer=b)},d=function(a,b){if(typeof a=="string"){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="arraybuffer",d.onload=function(){c(b,d.response)},d.send()}};b.load=function(b,c){if(typeof c=="function"||typeof c=="object")a.platform==="web"?d(b,c):a.platform!=="node"}}(b.binary={}),function(a){var b=function(a,b,c,d){typeof c=="function"?c({samplerate:a,buffer:b,err:d}):typeof c=="object"&&(c.samplerate=a,c.buffer=b,c.err=d)};a.decode=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(!a instanceof ArrayBuffer)b(0,null,c,"TypeError: wave.decode is expected an ArrayBuffer");else{a=new Uint8Array(a);if(a[0]!==82||a[1]!==73||a[2]!==70||a[3]!==70){b(0,null,c,"HeaderError: not exists 'RIFF'");return}g=a[4]+(a[5]<<8)+(a[6]<<16)+(a[7]<<24);if(g+8!==a.length){b(0,null,c,"HeaderError: invalid data size");return}if(a[8]!==87||a[9]!==65||a[10]!==86||a[11]!==69){b(0,null,c,"HeaderError: not exists 'WAVE'");return}if(a[12]!==102||a[13]!==109||a[14]!==116||a[15]!==32){b(0,null,c,"HeaderError: not exists 'fmt '");return}i=a[16]+(a[17]<<8)+(a[18]<<16)+(a[19]<<24),j=a[20]+(a[21]<<8),k=a[22]+(a[23]<<8),l=a[24]+(a[25]<<8)+(a[26]<<16)+(a[27]<<24),m=a[28]+(a[29]<<8)+(a[30]<<16)+(a[31]<<24),n=a[32]+(a[33]<<8),o=a[34]+(a[35]<<8);if(a[36]!==100||a[37]!==97||a[38]!==116||a[39]!==97){b(0,null,c,"HeaderError: not exists 'data'");return}h=a[40]+(a[41]<<8)+(a[42]<<16)+(a[43]<<24),p=(h/k>>1)/l;if(h>a.length-44){b(0,null,c,"HeaderError: not exists data");return}d=new Int16Array(p*l|0),o===8?q=new Int8Array(a.buffer,44):o===16?q=new Int16Array(a.buffer,44):o===32?q=new Int32Array(a.buffer,44):o===24&&(q=function(){var b,c,d,e,f,g,h,i,j;b=new Int32Array((a.length-44)/3),j=0;for(h=44,i=a.length;h<i;)c=a[h++],d=a[h++],e=a[h++],f=c+(d<<8)+(e<<16),g=f&8388608?-((f^16777215)+1):f,b[j++]=g;return b}());if(q){if(k===1){(function(){var a,e,f;e=1/(1<<o-1)*32768,f=1/((1<<o-1)-1)*32767;for(a=d.length;a--;)d[a]=q[a]*(q[a]<0?e:f);b(l,d,c)})();return}if(k===2){(function(){var a,e,f,g,h,i,j,k;j=1/(1<<o-1),k=1/((1<<o-1)-1);for(a=e=0,f=d.length;e<f;a+=2,++e)h=q[a]*(q[a]<0?j:k),i=q[a+1]*(q[a+1]<0?j:k),g=(h+i)*.5,d[e]=g*(g<0?32768:32767);b(l,d,c)})();return}}b(0,null,c,"not implementation")}}}(b.wav={}),b.exports=function(c){var d,e,f,g=[];if((d=b.$exports[c])!==undefined)for(e=d.length;e--;)f=d[e],a._global[f]=b[f],g.unshift(f);return g.join(",")};return b}(b),typeof window=="object"&&function(a,b){var c=function(){var b=function(){e.apply(this,arguments)},c=b.prototype,d=function(){var b,c,d;b=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder,c=a.URL||a.webkitURL;if(b&&c){d=new b,d.append("onmessage=t=function(e){clearInterval(t);if(i=e.data)t=setInterval(function(){postMessage(0)},i)}");return c.createObjectURL(d.getBlob())}return null}(),e=function(){d?this._timer=new Worker(d):this._timer=null,this._timerId=0,this._ugly_patch=0};c.setInterval=function(b,c){this._timer!==null?(this._timer.onmessage=b,this._timer.postMessage(c),/mac.*firefox/i.test(a.navigator.userAgent)&&(a.clearInterval(this._ugly_patch),this._ugly_patch=a.setInterval(function(){},1e3))):(this._timerId!==0&&a.clearInterval(this._timerId),this._timerId=a.setInterval(b,c))},c.clearInterval=function(){this._timer!==null?(this._timer.postMessage(0),this._ugly_patch&&(a.clearInterval(this._ugly_patch),this._ugly_patch=0)):this._timerId!==0&&(a.clearInterval(this._timerId),this._timerId=0)};return b}(),d=function(a){var c,d;c=new webkitAudioContext,b.samplerate=c.sampleRate,d=c.createJavaScriptNode(a.streamsize,1,a.channels),d.onaudioprocess=function(b){var c,d,e,f,g;a.process(),c=a.L,d=a.R,e=b.outputBuffer.getChannelData(0),f=b.outputBuffer.getChannelData(1);for(g=e.length;g--;)e[g]=c[g],f[g]=d[g]};return{on:function(){d.connect(c.destination)},off:function(){d.disconnect()}}},e=function(a){var d,e,f,g,h;d=new Audio,d.mozSetup(a.channels,b.samplerate),b.samplerate=d.mozSampleRate,b.channels=d.mozChannels,e=new c,f=a.streamsize/b.samplerate*1e3,g=new Float32Array(a.streamsize*a.channels),h=function(){var b,c,e,f;d.mozWriteAudio(g),a.process(),b=a.L,c=a.R,e=g.length,f=b.length;while(f--)g[--e]=c[f],g[--e]=b[f]};return{on:function(){e.setInterval(h,f)},off:function(){e.clearInterval()}}};typeof webkitAudioContext=="function"?(b.env="webkit",b._sys.bind(d)):typeof Audio=="function"&&typeof (new Audio).mozSetup=="function"&&(b.env="moz",b._sys.bind(e)),b.platform="web",b._global=a,a.T=b}(a,b),typeof importScripts=="function"&&function(a,b){a.actions={},a.actions["wav.decode"]=function(c){var d;d=c.src,/\.wav$/.test(d)&&b.utils.binary.load(d,function(c){b.utils.wav.decode(c,function(b){var c,d,e;if(b.err)a.postMessage({result:undefined,err:err});else{c=b.buffer,a.postMessage({result:"metadata",samplerate:b.samplerate,bufferSize:c.length}),d=0;do e=c.subarray(d,d+8192),a.postMessage({result:"data",array:e,offset:d}),d+=e.length;while(e.length);a.postMessage({result:"ended"})}})})},a.onmessage=function(b){var c=a.actions[b.data.action];c!==undefined&&c(b.data)},b.platform="web",b._global=a}(a,b),typeof process=="object"&&process.title==="node"&&function(a,b){b.platform="node",b._global=global,module.exports=b}(a,b);return b}(this)