<html>
  <head>
    <meta charset="utf-8"/>
    <title>doc: oscillator</title>
    <link type="text/css" media="screen" rel="stylesheet" href="css/style.css" />
    <link type="text/css" media="screen" rel="stylesheet" href="css/prettify.css" />
    <link type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Comfortaa:700">
  </head>
  <body>
    <canvas id="waveviewer"></canvas>
    <section id="body">
      <header style="margin:5px 0px 15px 0px">
        <h1 id="title"><a href="/timbre">timbre</a></h1>
        <span>JavaScript Library for Objective Sound Programming</span><br/>
      </header>
      
      <div id="caution">system requirements: Chrome 14- or Firefox 4-</div>

      <div id="contents">
        <h2>Oscillator</h2>
        <p class="desc">
          Linear interpolating wavetable lookup oscillator with frequency modulation input.
        </p>
        <h3>Constructor</h3>
        <pre id="ex0" class="prettyprint">
osc = T("osc", wave="sin", freq=440, mul=1, add=0);

// wave [String / Function / Float32Array]
// freq [Object] Frequency
// mul  [Number] Multiply the output  (default is 1)
// add  [Number]   and add the output (default is 0)

osc.play();
        </pre>

        <h3>Properties</h3>
        <pre id="ex1" class="prettyprint">
osc = T("osc");

osc.wave  = "tri";
osc.freq  = 880;
osc.phase = 0.5;
osc.mul   = 0.2;
osc.add   = 0.8;

osc.play();
        </pre>
        
        <h3>Waveform</h3>
        <pre id="ex2" class="prettyprint">
wave = ["sin", "tri", "saw", "pulse", "fami"][(Math.random()*5)|0];

T("osc", wave, 660, 0.5).play();


// The oscillator class has some aliases.
T("sin"), T("tri"), T("saw"), T("pulse"), T("fami");

// It's same as the above code.
T(wave, 1320, 0.5).play();

// (push [bang] button to change the wave)
        </pre>
        
        <h3>Customizing the waveform</h3>
        <pre id="ex3" class="prettyprint">
// Define custom waveform from a function
func = function(x) { return x * x * x; };
T("osc", func, 880).play(); 

// From an array (PWM25%)
T("osc", [ -1, +1, +1, +1 ], 880);

// Directly set
T("osc", new Float32Array(1024), 880);
        </pre>

        <h3>Register the waveform</h3>
        <pre id="ex4" class="prettyprint">
// Register a waveform and use it
T("osc").setWaveform("myosc", function(x) {
    return Math.random() - 0.5;
});

T("osc", "myosc", 1340).play();

// Get a waveform
// (push [bang] button and see the result at WebConsole)
T("osc").getWaveform("myosc"); // Float32Array(1024)
        </pre>

        <h3>tremolo</h3>
        <pre id="ex5" class="prettyprint">
T("*", T("tri", 880, 0.25),
       T("+sin", 8).kr());

// kr() method switches to processing mode 'Control Rate'
// Control rate are used for low frequency or slowly chaning control signal.

// T("+sin") generate signals between 0.0 and 1.0.
// It's convenient to control amplitude.
//   T("+sin"), T("+saw"), T("+tri") or T("+pulse")
        </pre>

        <h3>vibrato</h3>
        <pre id="ex6" class="prettyprint">
T("tri", T("tri", 2, 30, 880).kr(), 0.25);
        </pre>
        
        <h3>glide</h3>
        <pre id="ex7" class="prettyprint">
synth = T("fami", T("glide", 150, 880), 0.25);
cnt   = 0;

synth.onbang = function() {
    synth.freq.value = [880, 1320, 1100, 660][++cnt % 4]
};

synth.play();
        </pre>
        
      </div>
    </section>
  </body>
  <script type="text/javascript" src="js/prettify.js"></script>
  <script type="text/javascript">prettyPrint();</script>
  <script type="text/javascript" src="../timbre.js"></script>
  <script type="text/javascript" src="oscillator.js"></script>
  <script type="text/javascript" src="js/waveviewer.js"></script>  
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript">
    $(function() {
        if (!timbre.isEnabled) $("#caution").show();
        
        var viewer = new WaveViewer(timbre.sys.cell, 60, "waveviewer", 512, 256);
        
        timbre.addEventListener("on", function() {
            $("#title").css("color", "rgb(0, 136, 0)");
            viewer.start();
        });
        timbre.addEventListener("off", function() {
            $("#title").css("color", "rgb(136, 136, 136)");
            viewer.pause();
        });

        var list = [];
        $("pre").each(function(i, pre) {
            var $pre = $(pre);
            var $elem = $(pre).prev();
            var synth = window[$pre.attr("id")];
            if (synth instanceof HTMLElement) return;
            
            $("<button>").text("play").on("click", function() {
                $pre.css("background", "rgba(255,224,224,0.75)");
                synth.play();
            }).insertBefore($elem);
            $("<button>").text("pause").on("click", function() {
                $pre.css("background", "rgba(255,255,255,0.75)");
                synth.pause();
            }).insertBefore($elem);
            $("<button>").text("bang").on("click", function() {
                synth.bang();
            }).insertBefore($elem);

            synth.addEventListener("play" , function() {
                timbre.on();
            });
            synth.addEventListener("pause", function() {
                synth.dac.off();
                if (list.every(function(synth) {
                    return !synth.dac || synth.dac.isOff;
                })) timbre.off();
            });
            
            list.push(synth);
        });
    });
  </script>
</html>
